# Supabase setup for Notes

Supabase offers a generous free tier. This guide walks you through creating a project, setting up the database table and storage bucket, and connecting your site so notes are stored in Supabase and displayed (with download) in the PDF viewer.

---

## 1. Create a Supabase project

1. Go to [Supabase](https://supabase.com/) and sign in (GitHub is fine).
2. Click **New project**.
3. Choose your organization, set a **Project name** (e.g. `dipti-notes`) and a **Database password** (store it safely).
4. Pick a **Region** close to you.
5. Click **Create new project** and wait for the project to be ready.

---

## 2. Get your API credentials

1. In the left sidebar go to **Project settings** (gear icon) → **API**.
2. Under **Project API keys** you’ll see:
   - **Project URL** (e.g. `https://xxxxx.supabase.co`) → use as `VITE_SUPABASE_URL`
   - **anon public** key → use as `VITE_SUPABASE_ANON_KEY`
3. Keep the **service_role** key secret; don’t use it in the browser. The **anon** key is safe for client-side use with Row Level Security (RLS) limiting what users can do.

---

## 3. Add config to your project

1. In your repo, create `.env.local` with:

   ```env
   VITE_SUPABASE_URL=https://your-project-ref.supabase.co
   VITE_SUPABASE_ANON_KEY=your-anon-key-here
   ```

   `.env.local` is gitignored, so your keys stay local.

---

## 4. Create the note items table (Firestore replacement)

1. In the left sidebar go to **Table Editor**.
2. Click **New table**.
3. Set:
   - **Name:** `note_items`
   - **Columns:** add the following (or create the table and add columns after):

   | Column        | Type    | Default / nullable | Description |
   |---------------|---------|--------------------|-------------|
   | `id`          | `int8`  | auto (identity)    | Primary key (auto-generated) |
   | `category_id` | `text`  | not null           | e.g. `plaksha-university`, `gate` |
   | `subject_id`  | `text`  | not null           | e.g. `discrete-maths`, `machine-learning` |
   | `folder_type` | `text`  | not null           | One of: `Class Notes`, `Tutorials/Assignments`, `Exam Practice`, `Past Papers` |
   | `title`       | `text`  | not null           | Label shown in the UI |
   | `storage_path`| `text`  | not null           | Path of the PDF in Storage (see below) |
   | `order`       | `int4`  | nullable           | Sort order (smaller first) |

   All notes are PDFs stored in Supabase Storage; there are no external links. Each row must have `storage_path` pointing to a file in the `Notes` bucket.

4. Enable **RLS** on the table: **Authentication → Policies** (or Table Editor → table → RLS). Add a policy so anyone can read:
   - **Policy name:** `Allow public read`
   - **Allowed operation:** `SELECT`
   - **Target roles:** `anon`
   - **USING expression:** `true`
5. Save. You can leave **INSERT/UPDATE/DELETE** without policies so only the dashboard (or a backend) can write.

**Optional – SQL way:** In **SQL Editor** run:

```sql
create table public.note_items (
  id bigint generated by default as identity primary key,
  category_id text not null,
  subject_id text not null,
  folder_type text not null,
  title text not null,
  storage_path text not null,
  "order" int4
);

alter table public.note_items enable row level security;

create policy "Allow public read"
  on public.note_items for select
  to anon
  using (true);
```

---

## 5. Create the Storage bucket for PDFs

1. In the left sidebar go to **Storage**.
2. Click **New bucket**.
3. **Name:** `Notes` (must match the app’s `NOTES_BUCKET` — capital N).
4. **Public bucket:** turn **ON** so the app can build public URLs for viewing and download without signed URLs.
5. Click **Create bucket**.

**Required: allow listing files (RLS on Storage)**  
The app calls `list()` on folder paths to show PDFs. Without this policy, the list returns empty and no PDFs appear. In **SQL Editor** run:

```sql
-- Allow anyone to list and read files in the Notes bucket (required for PDFs to show)
create policy "Allow public list and read Notes bucket"
on storage.objects for select
to anon
using ( bucket_id = 'Notes' );
```

If you already have a policy on `storage.objects` for the `Notes` bucket, you can skip this. Otherwise, adding it fixes “PDFs don’t show” when the path and bucket name are correct.

---

## 6. Where to store notes

### Database (metadata) – `note_items` table

Each row = one PDF note. All notes are PDFs in Storage; no external links.

| Column         | Example | Description |
|----------------|---------|-------------|
| `category_id`  | `plaksha-university` | Must match your app’s category IDs. |
| `subject_id`   | `discrete-maths`     | Must match your app’s subject IDs. |
| `folder_type`  | One of: `Class Notes`, `Tutorials/Assignments`, `Exam Practice`, `Past Papers` | Exact string. |
| `title`        | `Lecture 1` or `2024 Past Paper` | Shown in the UI. |
| `storage_path` | `plaksha-university/discrete-maths/class-notes/lecture-1.pdf` | Path inside the `Notes` bucket (required). |
| `order`        | `0`, `1`, …          | Optional; lower = first. |

**Example row:**

- `category_id`: `plaksha-university`
- `subject_id`: `discrete-maths`
- `folder_type`: `Past Papers`
- `title`: `2024 Past Paper`
- `storage_path`: `plaksha-university/discrete-maths/past-papers/2024-past-paper.pdf`
- `order`: `1`

Add rows via **Table Editor** → `note_items` → **Insert row**, or via SQL in **SQL Editor**.

### Storage (PDF files) – `Notes` bucket

All note files are PDFs. Use one of these folder names under each subject to match `folder_type`:

- `class-notes` → `Class Notes`
- `tutorials-assignments` → `Tutorials/Assignments`
- `exam-practice` → `Exam Practice`
- `past-papers` → `Past Papers`

**Path pattern:**  
`{category_id}/{subject_id}/{folder-slug}/{filename}.pdf`

**Examples:**
- `plaksha-university/discrete-maths/class-notes/lecture-1.pdf`
- `plaksha-university/discrete-maths/tutorials-assignments/assignment-1.pdf`
- `plaksha-university/discrete-maths/exam-practice/midterm-2024.pdf`
- `plaksha-university/discrete-maths/past-papers/2024-past-paper.pdf`
- `gate/mathematics/past-papers/sample.pdf`

Use the **exact same path** in the `storage_path` column for that note. PDFs open in the app’s in-app viewer.

**How the app finds files:** The app lists files **folder-wise from Storage**. For each subject it looks under paths like `{category_id}/{subject_id}/{folder_slug}/` (e.g. `plaksha-university/discrete-maths/past-papers/`). Create that folder structure in the **Notes** bucket and upload PDFs there; they will show up automatically under the right section on the website. You do not need to add rows to `note_items` unless you also want to use the table for custom titles or ordering.

**How to upload (Dashboard only):**

1. Go to **Storage** → **Notes** bucket.
2. Create folders to match the path (e.g. `plaksha-university` → `discrete-maths` → `past-papers`).
3. Upload the PDF (e.g. `2024-past-paper.pdf`).
4. In **Table Editor** → `note_items`, add a row with `storage_path` = the full path (e.g. `plaksha-university/discrete-maths/past-papers/2024-past-paper.pdf`) and the other fields. PDFs then open in the app’s in-app viewer.

---

## 7. Category and subject IDs

Use the same IDs as in your app’s constants (`src/constants/index.js`):

- **Categories:** `plaksha-university`, `software-development`, `gate`
- **Subjects:** e.g. `machine-learning`, `discrete-maths`, `react-js`, `c-programming`, etc.
- **folder_type:** exactly one of: `Class Notes`, `Tutorials/Assignments`, `Exam Practice`, `Past Papers`.

---

## 8. Run the app

```bash
npm install
npm run dev
```

Open the Notes page. If Supabase is configured and `note_items` has rows, the app will list them and open each PDF in the in-app viewer (view and download). If Supabase isn’t configured or there’s an error, the app falls back to the static list from constants.

---

## 9. Deploy (e.g. GitHub Pages)

For production you need the same env vars where the app is built:

- **GitHub Actions:** Add `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY` as repository **Secrets**, and in your build step expose them as **Environment variables** so `import.meta.env.VITE_SUPABASE_*` are set at build time.
- **Local deploy:** Run `npm run build` and `npm run deploy` on your machine where `.env.local` exists; the built site will contain the config. The anon key is safe for client-side use with RLS and public read-only access.

---

## Summary

| What              | Where                     | Purpose |
|-------------------|---------------------------|---------|
| Note metadata     | Table `note_items`        | List of notes (title, category, subject, folder, `storage_path`) — PDFs only |
| PDF files         | Storage bucket `Notes`    | Files to view and download in the in-app viewer |
| Config            | `.env.local`              | So the app can talk to your Supabase project |

After setup, add notes by uploading PDFs to the `Notes` bucket and inserting rows in `note_items` with the matching `storage_path`.
